name: "NestJS Build"
description: "Instala dependencias, ejecuta tests opcionales y compila una app NestJS"

inputs:
  node_version:
    description: "Node.js version"
    required: false
    default: "20"

  working_directory:
    description: "Directorio donde vive la app NestJS"
    required: false
    default: "."

  run_tests:
    description: "Run tests (true / false)"
    required: false
    default: "false"
  
  #SBoom: 
  #  description: "Prueba de conflicto"
  #  required: false
  #  default: "false"

runs:
  using: "composite" # Indica que es una acci√≥n compuesta, osea que agrupa varios pasos (steps)
  steps:
    - name: Setup Node.js
      uses: actions/setup-node@v4
      with:
        node-version: ${{ inputs.node_version }}
        cache: npm
        cache-dependency-path: ${{ inputs.working_directory }}/package-lock.json

    - name: Install dependencies
      shell: bash
      run: npm ci
      working-directory: ${{ inputs.working_directory }}

    - name: Run tests
      if: ${{ inputs.run_tests == 'true' }}
      shell: bash
      run: npm test
      working-directory: ${{ inputs.working_directory }}

    - name: Build NestJS
      shell: bash
      run: npm run build
      working-directory: ${{ inputs.working_directory }}
    
  #  - name: Generate SBOM
  #    if: ${{ inputs.SBoom == 'true' }}
  #    shell: bash      
  #    run: npx @cyclonedx/cyclonedx-npm --output-file sbom.json


  #  - name: Upload SBOM
  #    if: ${{ inputs.SBoom == 'true' }}
  #    uses: actions/upload-artifact@v4
  #    with:
  #      name: sbom
  #      path: sbom.json
