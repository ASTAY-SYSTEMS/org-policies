# secret para la integracion con la herramienta:  odt_ig6zKyXu_IGOL0HItWfp8n2alZBjjL7nlpOMbzvwQ
name: "SCA - OWASP Dependency-Track"
description: "Ejecuta análisis SCA con OWASP Dependency-Track"
inputs:
  api_url:
    description: "Dependency-Track API URL"
    required: true
  api_key:
    description: "Dependency-Track API Key"
    required: true
  sbom_path:
    description: "Path to SBOM file"
    required: true
    default: "sbom.json"
  project_name:
    description: "Dependency-Track project name"
    required: true
  project_version:
    description: "Dependency-Track project version"  
    required: true
    default: "latest"
runs:
  using: "composite" # Indica que es una acción compuesta, osea que agrupa varios pasos (steps)
  steps:

    - name: Generar SBOM con Anchore SBOM Action
      uses: anchore/sbom-action@v0
      with:
        path: .
        format: cyclonedx-json
        output-file: ${{ inputs.sbom_path }}

    - name: Upload SBOM to Dependency-Track
      shell: bash
      run: |
        echo "Uploading SBOM to Dependency-Track..."
        curl -X POST "${{ inputs.api_url }}/api/v1/bom" \
          -H "X-API-Key: ${{ inputs.api_key }}" \
          -F "projectName=${{ inputs.project_name }}" \
          -F "projectVersion=${{ inputs.project_version }}" \
          -F "autoCreate=true" \
          -F "bom=@${{ inputs.sbom_path }}"